
{% extends "base.html" %}

{% block title %}Добавить расход - MyBudget{% endblock %}
{% block page_title %}Новый расход{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <!-- Header with Back Button -->
    <div class="mb-8 flex items-center justify-between">
        <a href="{% url 'finance:dashboard' %}" class="inline-flex items-center gap-2 text-sm font-black text-slate-400 uppercase tracking-widest hover:text-[#609988] transition-colors">
            <i data-lucide="arrow-left" class="w-4 h-4"></i>
            Отмена
        </a>
    </div>

    <div class="card overflow-hidden">
        <form method="post" onsubmit="return validateCat()" class="p-10 space-y-10 bg-white">
            {% csrf_token %}
        <!-- Header Info -->
            <div class="bg-slate-900 p-10 text-center relative overflow-hidden">
                <div class="absolute top-0 right-0 w-40 h-40 bg-rose-500/10 blur-[60px] rounded-full -mr-20 -mt-20"></div>
                <div class="relative space-y-4">
                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-[0.3em]">Введите сумму дохода</label>
                    <div class="flex items-center justify-center gap-4">
                        <input type="number" name="amount" min="0" step="1000" placeholder="0" 
                            class="w-full max-w-[320px] text-6xl font-black text-center text-white bg-transparent border-none outline-none focus:ring-0 placeholder:text-slate-700" 
                            autofocus id="expense-amount">
                        <span class="text-2xl font-black text-rose-500 uppercase">UZS</span>
                    </div>
                </div>
            </div>

            <!-- Account & Date Row -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="space-y-3">
                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest px-1">Поступлениу в счет</label>
                    <div class="relative group">
                        <select name="wallet" class="w-full appearance-none bg-slate-50 border-none p-4 pr-12 rounded-2xl text-sm font-bold text-slate-700 focus:ring-2 focus:ring-rose-500/10 transition-all outline-none">
                            {% for account in accounts %}
                            <option value="{{ account.id }}">{{ account.name }}</option>
                            {% endfor %}
                        </select>
                        <i data-lucide="chevron-down" class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 text-slate-300 pointer-events-none group-focus-within:text-rose-500"></i>
                    </div>
                </div>
            </div>

            <!-- Category Grid -->
            <div class="space-y-4">
                <div class="flex items-center justify-between px-1">
                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Категория</label>
                    <button type="button" class="text-[10px] font-black text-[#609988] uppercase hover:underline">Редактировать</button>
                </div>
                <input type="hidden" name="category" id="category-hidden">
                <div class="grid grid-cols-3 sm:grid-cols-6 gap-3">
                    {% for cat in category %}
                        {% if cat.type == 'income' %}
                        <button type="button" data-cat-id="{{ cat.id }}" onclick="selectCat(this)" class="cat-btn flex flex-col items-center gap-2 p-4 rounded-2xl bg-white border-2 border-[#609988] text-[#609988] transition-all">
                            <i data-lucide="{{cat.icon}}" class="w-6 h-6"></i>
                            <span class="text-[9px] font-black uppercase">{{ cat.name }}</span>
                        </button>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            <!-- Actions -->
            <div class="pt-6 flex flex-col sm:flex-row gap-4">
                <button type="submit" class="flex-1 bg-rose-500 text-white py-5 rounded-[2rem] font-black text-sm uppercase tracking-widest shadow-xl shadow-rose-900/20 hover:bg-rose-600 transition-all">
                    Сохранить доход
                </button>
                <a href="{% url 'finance:dashboard' %}">
                <button type="button" class="px-12 py-5 bg-slate-100 text-slate-500 rounded-[2rem] font-black text-sm uppercase tracking-widest hover:bg-slate-200 transition-all">
                    Отмена
                </button>
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function selectCat(btn) {
        document.querySelectorAll('.cat-btn').forEach(b => {
            b.classList.remove('border-[#609988]', 'text-[#609988]', 'bg-white');
            b.classList.add('bg-slate-50', 'border-transparent', 'text-slate-400');
        });

        btn.classList.add('border-[#609988]', 'text-[#609988]', 'bg-white');
        btn.classList.remove('bg-slate-50', 'border-transparent', 'text-slate-400');

        // ✅ category id ni hidden inputga yozamiz
        document.getElementById("category-hidden").value = btn.dataset.catId;
    }
  
    function validateCat(){
        const v = document.getElementById("category-hidden").value;
        if(!v){
            alert("Категория не выбрана!");
            return false;
        }
        return true;
    }

    const amountInput = document.getElementById("expense-amount");

    amountInput.addEventListener("input", () => {
        if (amountInput.value < 0) {
            amountInput.value = "";
        }
    });
</script>
{% endblock %}
